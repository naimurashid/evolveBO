% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/constraints.R
\name{filter_history_for_constraints}
\alias{filter_history_for_constraints}
\title{Filter History for New Constraints}
\usage{
filter_history_for_constraints(history, new_constraints, verbose = TRUE)
}
\arguments{
\item{history}{Data frame from previous stage(s)}

\item{new_constraints}{Named list of new constraints being added
(e.g., list(power = c("ge", 0.80)))}

\item{verbose}{Logical: print filtering details?}
}
\value{
List with:
  \describe{
    \item{history}{Filtered history data frame, or NULL if all rows dropped}
    \item{n_original}{Integer: original row count}
    \item{n_retained}{Integer: retained row count}
    \item{metrics_checked}{Character: names of metrics that were checked}
  }
}
\description{
When adding constraints in later stages, filters history to only include
rows that have the required metrics (not NA). This prevents poisoning
the GP surrogate with incomplete data from earlier stages that didn't
evaluate the new constraint metrics.
}
\examples{
\dontrun{
# Stage 2 adds PET constraint not evaluated in Stage 1
new_constraints_s2 <- list(PET_fut_null = c("ge", 0.30))

result <- filter_history_for_constraints(
  history = fit_s1$history,
  new_constraints = new_constraints_s2
)

if (result$n_retained > 0) {
  # Use filtered history for Stage 2 warmstart
  initial_history_s2 <- result$history
} else {
  # Stage 2 must start fresh (no usable history)
  initial_history_s2 <- NULL
}
}
}
