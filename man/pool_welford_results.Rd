% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/welford.R
\name{pool_welford_results}
\alias{pool_welford_results}
\title{Compute mean and variance from parallel simulation chunks}
\usage{
pool_welford_results(chunk_results)
}
\arguments{
\item{chunk_results}{A list where each element is a list with components
`mean` (numeric vector), `M2` (sum of squared deviations), and `n`
(number of samples). Typically produced by calling [welford_mean_var()]
on each parallel worker.}
}
\value{
A list with components:
  \describe{
    \item{mean}{Pooled mean across all chunks}
    \item{variance}{Pooled variance of the mean}
    \item{n}{Total number of samples}
  }
}
\description{
When running simulations in parallel, each worker computes summary statistics
independently. This function pools results from multiple workers, correctly
accounting for both within-chunk and between-chunk variance.
}
\details{
Uses Chan's parallel variance algorithm to combine statistics from
independent chunks. This correctly accounts for variance both within and
between chunks.
}
\examples{
\dontrun{
# Parallel simulation example
library(parallel)
n_cores <- 4
n_rep <- 10000

# Run simulations in parallel chunks
chunk_results <- mclapply(1:n_cores, function(core_id) {
  chunk_size <- n_rep / n_cores
  welford_mean_var(
    sample_fn = function(i, theta) run_trial(theta),
    n_samples = chunk_size,
    theta = theta
  )
}, mc.cores = n_cores)

# Pool results
pooled <- pool_welford_results(chunk_results)

# Use in simulator
metrics <- pooled$mean
attr(metrics, "variance") <- pooled$variance
attr(metrics, "n_rep") <- pooled$n
}

}
\references{
Chan, Tony F.; Golub, Gene H.; LeVeque, Randall J. (1979), "Updating
Formulae and a Pairwise Algorithm for Computing Sample Variances"
}
